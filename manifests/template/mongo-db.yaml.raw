# All options for PerconaServerMongoDB can be seen here: https://www.percona.com/doc/kubernetes-operator-for-psmongodb/operator.html
apiVersion: templating.flanksource.com/v1
kind: Template
metadata:
  name: mongo-db
spec:
  source:
    apiVersion: db.flanksource.com/v1
    kind: MongoDB
  resources:
    - apiVersion: psmdb.percona.com/v1-6-0
      kind: PerconaServerMongoDB
      metadata:
        name: mongodb-{{ .metadata.name }}
        namespace: '{{ .metadata.namespace }}'
      spec:
        crVersion: 1.6.0
        image: percona/percona-server-mongodb:4.4.2-4
        imagePullPolicy: IfNotPresent
        allowUnsafeConfigurations: false
        updateStrategy: SmartUpdate
        upgradeOptions:
          versionServiceEndpoint: https://check.percona.com
          apply: recommended
          schedule: "0 2 * * *"
        secrets:
          users: mongodb-{{ .metadata.name }}-secrets
        pmm:
          enabled: false
        replsets:
          - name: rs0
            size: 3
            podDisruptionBudget:
              maxUnavailable: 1
            resources:
              limits:
                cpu: '{{.spec.cpu | default "300m"}}'
                memory: '{{.spec.memory | default "512Mi" }}'
              requests:
                cpu: '{{.spec.cpu | default "300m"}}'
                memory: '{{.spec.memory | default "512Mi" }}'
            volumeSpec:
              persistentVolumeClaim:
                resources:
                  requests:
                    storage: '{{ .spec.storage.size | default "5Gi" }}'
